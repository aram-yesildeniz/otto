import"first-input-delay";var t=function(t,i,e){this.name=t,this.version=i,this.os=e},i=function(t){this.version=t,this.name="node",this.os=process.platform},e=function(){this.bot=!0,this.name="bot",this.version=null,this.os=null},n=3,s=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],r=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function o(){return"undefined"!=typeof navigator?function(i){var o=""!==i&&s.reduce((function(t,e){var n=e[0],s=e[1];if(t)return t;var r=s.exec(i);return!!r&&[n,r]}),!1);if(!o)return null;var a=o[0],u=o[1];if("searchbot"===a)return new e;var c=u[1]&&u[1].split(/[._]/).slice(0,3);c?c.length<n&&(c=c.concat(new Array(n-c.length).fill("0"))):c=[];return new t(a,c.join("."),function(t){var i=r.find((function(i){i[0];return i[1].test(t)}));return i?i[0]:null}(i))}(navigator.userAgent):"undefined"!=typeof process&&process.version?new i(process.version.slice(1)):null}var a,u,c,f,h=function(){return+new Date},d="function"==typeof window.requestIdleCallback,l=function(){function t(t){this.initTime_=t}return Object.defineProperty(t.prototype,"didTimeout",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.timeRemaining=function(){return Math.max(0,50-(h()-this.initTime_))},t}(),p=d?window.requestIdleCallback:function(t){var i=new l(h());return setTimeout((function(){return t(i)}),0)},g=d?window.cancelIdleCallback:function(t){clearTimeout(t)},m="function"==typeof Promise&&Promise.toString().indexOf("[native code]")>-1,w="MutationObserver"in window||"WebKitMutationObserver"in window||"MozMutationObserver"in window,y=m?function(t){Promise.resolve().then(t)}:w?(a=0,u=[],c=new MutationObserver((function(){u.forEach((function(t){return t()})),u=[]})),f=document.createTextNode(""),c.observe(f,{characterData:!0}),function(t){u.push(t),f.data=String(++a%2)}):function(t){},b=0,v=!("object"!=typeof window.safari||!window.safari.pushNotification),T=function(){function t(t){var i=void 0===t?{}:t,e=i.ensureTasksRun,n=void 0!==e&&e,s=i.defaultMinTaskTime,r=void 0===s?b:s;this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.idleCallbackHandle_=null,this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.defaultMinTaskTime_=r,this.ensureTasksRun_=n,this.runTasksImmediately=this.runTasksImmediately.bind(this),this.runTasks_=this.runTasks_.bind(this),this.onVisibilityChange_=this.onVisibilityChange_.bind(this),this.ensureTasksRun_&&(addEventListener("visibilitychange",this.onVisibilityChange_,!0),v&&addEventListener("beforeunload",this.runTasksImmediately,!0))}return t.prototype.pushTask=function(t){this.addTask_(Array.prototype.push,t)},t.prototype.unshiftTask=function(t){this.addTask_(Array.prototype.unshift,t)},t.prototype.runTasksImmediately=function(){this.runTasks_()},t.prototype.hasPendingTasks=function(){return this.taskQueue_.length>0},t.prototype.clearPendingTasks=function(){this.taskQueue_=[],this.cancelScheduledRun_()},t.prototype.getState=function(){return this.state_},t.prototype.destroy=function(){this.taskQueue_=[],this.cancelScheduledRun_(),this.ensureTasksRun_&&(removeEventListener("visibilitychange",this.onVisibilityChange_,!0),v&&removeEventListener("beforeunload",this.runTasksImmediately,!0))},t.prototype.addTask_=function(t,i,e){var n=(void 0===e?{}:e).minTaskTime,s=void 0===n?this.defaultMinTaskTime_:n,r={time:h(),visibilityState:document.visibilityState};t.call(this.taskQueue_,{state:r,task:i,minTaskTime:s}),this.scheduleTasksToRun_()},t.prototype.scheduleTasksToRun_=function(){this.ensureTasksRun_&&"hidden"===document.visibilityState?y(this.runTasks_):this.idleCallbackHandle_||(this.idleCallbackHandle_=p(this.runTasks_))},t.prototype.runTasks_=function(t){if(this.cancelScheduledRun_(),!this.isProcessing_){for(this.isProcessing_=!0;this.hasPendingTasks()&&!k(t,this.taskQueue_[0].minTaskTime);){var i=this.taskQueue_.shift(),e=i.task,n=i.state;this.state_=n,e(n),this.state_=null}this.isProcessing_=!1,this.hasPendingTasks()&&this.scheduleTasksToRun_()}},t.prototype.cancelScheduledRun_=function(){g(this.idleCallbackHandle_),this.idleCallbackHandle_=null},t.prototype.onVisibilityChange_=function(){"hidden"===document.visibilityState&&this.runTasksImmediately()},t}(),k=function(t,i){return!!(t&&t.timeRemaining()<=i)},P=function(){function t(t){this.config=t}return t.prototype.now=function(){return Date.now()/1e3},t.prototype.mark=function(t,i){},t.prototype.measure=function(t,i){return this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){var i=this;setTimeout((function(){t(i.getFirstPaint())}))},t.prototype.getDurationByMetric=function(t,i){return i.end-i.start||0},t.prototype.getFirstPaint=function(){var t=window.performance.timing,i={duration:0,entryType:"paint",name:"first-contentful-paint",startTime:0};return t&&0!==t.navigationStart&&(i.startTime=Date.now()-t.navigationStart),[i]},t}(),_=function(){function t(t){this.config=t}return t.supported=function(){return window.performance&&!!performance.now&&!!performance.mark},t.supportedPerformanceObserver=function(){return window.chrome&&"PerformanceObserver"in window},t.prototype.now=function(){return window.performance.now()},t.prototype.mark=function(t,i){var e="mark_"+t+"_"+i;window.performance.mark(e)},t.prototype.measure=function(t,i){var e="mark_"+t+"_start",n="mark_"+t+"_end";return window.performance.measure(t,e,n),this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){this.perfObserver=new PerformanceObserver(this.performanceObserverCb.bind(this,t)),this.perfObserver.observe({entryTypes:["paint"]})},t.prototype.getDurationByMetric=function(t,i){var e=this.getMeasurementForGivenName(t);return e&&"measure"===e.entryType?e.duration:-1},t.prototype.getMeasurementForGivenName=function(t){var i=window.performance.getEntriesByName(t);return i[i.length-1]},t.prototype.performanceObserverCb=function(t,i){var e=this,n=i.getEntries();t(n),n.forEach((function(t){e.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&e.perfObserver.disconnect()}))},t}(),C=function(){function t(t){var i=this;void 0===t&&(t={}),this.config={firstContentfulPaint:!1,firstPaint:!1,firstInputDelay:!1,googleAnalytics:{enable:!1,timingVar:"name"},browserTracker:!1,logPrefix:"Perfume.js:",logging:!0,maxMeasureTime:15e3,warning:!1,debugging:!1},this.firstPaintDuration=0,this.firstContentfulPaintDuration=0,this.firstInputDelayDuration=0,this.isHidden=!1,this.logMetricWarn="Please provide a metric name",this.metrics={},this.observers={},this.didVisibilityChange=function(){document.hidden&&(i.isHidden=document.hidden)},this.config=Object.assign({},this.config,t),this.perf=_.supported()?new _(this.config):new P(this.config),this.config.browserTracker&&(this.browser=o()),_.supportedPerformanceObserver()||(this.perfEmulated=new P(this.config)),(this.config.firstPaint||this.config.firstContentfulPaint)&&(this.observeFirstContentfulPaint=new Promise((function(t){i.logDebug("observeFirstContentfulPaint"),i.observers.fcp=t,i.initFirstPaint()}))),this.config.firstInputDelay&&(this.observeFirstInputDelay=new Promise((function(t){i.observers.fid=t,i.initFirstInputDelay()}))),this.onVisibilityChange(),this.queue=new T({ensureTasksRun:!0})}return t.prototype.start=function(t){this.checkMetricName(t)&&(this.metrics[t]?this.logWarn(this.config.logPrefix,"Recording already started."):(this.metrics[t]={end:0,start:this.perf.now()},this.perf.mark(t,"start"),this.isHidden=!1))},t.prototype.end=function(t){var i=this;if(this.checkMetricName(t)){var e=this.metrics[t];if(e){e.end=this.perf.now(),this.perf.mark(t,"end");var n=this.perf.measure(t,e),s=parseFloat(n.toFixed(2));return delete this.metrics[t],this.queue.pushTask((function(){i.log(t,s),i.sendTiming(t,s)})),s}this.logWarn(this.config.logPrefix,"Recording already stopped.")}},t.prototype.endPaint=function(t){var i=this;return new Promise((function(e){setTimeout((function(){var n=i.end(t);e(n)}))}))},t.prototype.log=function(t,i){if(!this.isHidden&&this.config.logging)if(t){var e=i.toFixed(2),n="%c "+this.config.logPrefix+" "+t+" "+e+" ms";window.console.log(n,"color: #ff6d00;font-size:11px;")}else this.logWarn(this.config.logPrefix,this.logMetricWarn)},t.prototype.logDebug=function(t,i){void 0===i&&(i=""),this.config.debugging&&window.console.log("Perfume.js debugging "+t+":",i)},t.prototype.sendTiming=function(t,i){if(!this.isHidden){var e=this.config.browserTracker?this.browser:void 0,n=this.addBrowserToMetricName(t);if(this.config.analyticsTracker&&this.config.analyticsTracker(t,i,e),this.config.googleAnalytics.enable)if(window.ga){var s=Math.round(i);window.ga("send","timing",n,this.config.googleAnalytics.timingVar,s)}else this.logWarn(this.config.logPrefix,"Google Analytics has not been loaded")}},t.prototype.addBrowserToMetricName=function(t){if(!this.config.browserTracker)return t;var i=t;this.browser.name&&(i+="."+this.browser.name.replace(/\s/g,""),this.browser.os&&(i+="."+this.browser.os.replace(/\s/g,"")));return i},t.prototype.checkMetricName=function(t){return!!t||(this.logWarn(this.config.logPrefix,this.logMetricWarn),!1)},t.prototype.firstContentfulPaintCb=function(t){var i=this;this.logDebug("firstContentfulPaintCb",t),t.forEach((function(t){i.queue.pushTask((function(){i.config.firstPaint&&"first-paint"===t.name&&i.logMetric(t.startTime,"First Paint","firstPaint"),i.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&i.logMetric(t.startTime,"First Contentful Paint","firstContentfulPaint")}))}))},t.prototype.initFirstPaint=function(){if(this.logDebug("initFirstPaint"),_.supportedPerformanceObserver()){this.logDebug("initFirstPaint.supportedPerformanceObserver");try{this.perf.firstContentfulPaint(this.firstContentfulPaintCb.bind(this))}catch(t){this.logWarn(this.config.logPrefix,"initFirstPaint failed")}}else this.perfEmulated&&(this.logDebug("initFirstPaint.perfEmulated"),this.perfEmulated.firstContentfulPaint(this.firstContentfulPaintCb.bind(this)))},t.prototype.initFirstInputDelay=function(){var t=this;_.supported()&&this.config.firstInputDelay&&perfMetrics.onFirstInputDelay((function(i,e){t.queue.pushTask((function(){t.logMetric(i,"First Input Delay","firstInputDelay")}))}))},t.prototype.onVisibilityChange=function(){void 0!==document.hidden&&document.addEventListener("visibilitychange",this.didVisibilityChange)},t.prototype.logMetric=function(t,i,e){var n=parseFloat(t.toFixed(2));n>this.config.maxMeasureTime||("firstPaint"===e&&(this.firstPaintDuration=n),"firstContentfulPaint"===e&&(this.firstContentfulPaintDuration=n,this.observers.fcp(n)),"firstInputDelay"===e&&(this.firstInputDelayDuration=n,this.observers.fid(n)),this.log(i,n),this.sendTiming(e,n))},t.prototype.logWarn=function(t,i){this.config.warning&&this.config.logging&&window.console.warn(t,i)},t}();export default C;
//# sourceMappingURL=perfume.esm.min.js.map
