!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function t(n,r,o,i){e(this,t),this.scid=o,this.pageMergeId=i,this.elementId=n,this.sendReferrer=!0,this.currentPath=r},u=function(){function t(n,r){e(this,t),this.computeScid=n,this.computePageMergeId=r;var o=new c(null,window.location.pathname+window.location.search,this.computeScid(),this.computePageMergeId(null));this.stack=[o]}return n(t,[{key:"resetScid",value:function(){this.currentTsid.scid=this.computeScid()}},{key:"needsReferrerSend",value:function(){var e=this.currentTsid.sendReferrer;return this.currentTsid.sendReferrer=!1,e}},{key:"resetPageMergeId",value:function(e){return this.currentTsid.pageMergeId=this.computePageMergeId(e),this.currentPageMergeId}},{key:"create",value:function(e,t){var n=new c(e,t,this.computeScid(),this.computePageMergeId(e));return this.stack.push(n),this.stack}},{key:"close",value:function(){var e=i({},this.currentTsid);return this.stack.length>1?(this.stack.pop(),e):null}},{key:"reset",value:function(){this.stack=this.stack.slice(0,1)}},{key:"hasAdditionalContext",get:function(){return this.stack.length>1}},{key:"currentTsid",get:function(){return this.stack[this.stack.length-1]},set:function(e){this.stack[this.stack.length-1]=e}},{key:"currentPath",get:function(){return this.currentTsid.currentPath},set:function(e){this.currentTsid.currentPath=e}},{key:"currentScid",get:function(){return this.currentTsid.scid||(this.currentTsid.scid=this.computeScid()),this.currentTsid.scid}},{key:"currentPageMergeId",get:function(){var e=this.currentTsid,t=e.pageMergeId,n=e.elementId;return t||(this.currentTsid.pageMergeId=this.computePageMergeId(n)),this.currentTsid.pageMergeId}},{key:"basePath",get:function(){return this.stack[0].currentPath}}]),t}();function s(e){return o_util.core.isEmptyObject(e,!1)}function d(e,t){return null!==e?e.getAttribute("data-".concat(t)):null}function l(e,t){var n=d(e,t);if(!n)return null;try{return JSON.parse(n)}catch(e){return null}}function g(e,t){function n(e){return"A"===e.tagName}function r(e){return Boolean(e&&e!==document&&e.className.indexOf)}function o(e){return!!r(e)&&!(n(e)&&function(e){return-1!==e.className.indexOf(t)}(e))}for(var i=e;o(i);)i=i.parentNode;return r(i)&&n(i)?i:null}function f(e){return Object.keys(e).filter((function(t){var n=e[t];return n||!1===n||0===n})).filter((function(t){var n=e[t];return!(o_util.core.isPlainObject(n)&&s(n))})).reduce((function(t,n){var r=e[n];return o_util.core.isPlainObject(r)||Array.isArray(r)?t[n]=JSON.stringify(r):t[n]=r,t}),{})}function v(e){return Object.keys(e).map((function(t){return{labelName:t,labelValue:"".concat(e[t])}}))}function h(){return o_global&&o_global.debug&&o_global.debug.status().activated}var m="getting sfid could not find an SFID. Check the HTML and make sure you render a div with class=ts-bct and a data-ts_sfid attribute containing the SFID";function b(e){var t=e?"#".concat(e," .ts-bct"):".ts-bct",n=document.querySelector(t);if(!n)return null;var r=d(n,"ts_sfid");return r?encodeURIComponent(r):(h()&&console.log(m),null)}function w(){return(new Date).getTime().toString()}function p(){return o_util.cookie.get("BrowserId")}function _(e){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n="",r=0;r<e;r++){n+=t[Math.floor(Math.random()*t.length)]}return n}var k,I=(k=null,function(){return k||(k=new u(w,b)),k}),y="".concat(window.location.protocol,"//").concat(window.location.host);function M(e){try{return e()}catch(e){return"unbekannt"}}function P(){var e=I();return e.hasAdditionalContext?y+e.basePath:o_global&&o_global.referrer?o_global.referrer:null}function T(e){var t=I(),n={};t.hasAdditionalContext&&(n.ts_ContextLevel=t.stack.length-1);var r=P();return"event"!==e&&"eventMerge"!==e&&r&&t.needsReferrerSend()&&(n.ts_DocReferrer=r),n}function x(e,t){var n={breakpoint:M((function(){return o_global.device.breakpoint.getCurrentBreakpoint().toUpperCase()})),orientation:M((function(){return o_global.device.orientation.getCurrentOrientation()})),innerWidth:window.innerWidth,innerHeight:window.innerHeight,screenHeight:window.screen.height,screenWidth:window.screen.width,mediaQueries:"matchMedia"in window||"msMatchMedia"in window};return{ts_Innersize:"".concat(n.innerWidth,"x").concat(n.innerHeight),ts_Screen:"".concat(n.screenWidth,"x").concat(n.screenHeight),ot_Orientation:e||n.orientation,ot_Breakpoint:t||n.breakpoint}}var O=function(e,t){return e.concat(t)};function S(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i=[e[o]].reduce(O,[]).map((function(e){return e.toString()}));t[o]=i}return t}function E(e){if(!e.name)throw new Error('Missing "name" in action');if(!e.features)throw new Error('Missing "features" in action');return{name:e.name,features:e.features.map((function(e){return A(e)}))}}function A(e){if(!e.id)throw new Error('Missing "id" in feature');if(!e.name)throw new Error('Missing "name" in feature');if(!e.status)throw new Error('Missing "status" in feature');if(!e.labels)throw new Error('Missing "labels" in feature');var t={id:e.id,status:e.status,name:e.name,labels:S(e.labels)};return["parentId","position","variationId"].forEach((function(n){n in e&&(t[n]=e[n])})),t}var j="tracking.bct.requests-merges",N="tracking.bct.requests-features",C="tracking.bct.batch-notifications",R=window.o_global.eventQBus,B="navigator"in window&&"function"==typeof window.navigator.sendBeacon,L=!0;function z(){return B&&L}var D=function(){function t(n,r,o){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:55e3;e(this,t),R.on(n,(function(e){return i.storeEntry(e)})),R.on(r,(function(e){return i.sendBatches(e)})),this.sendBatch=o,this.maxBatchBytes=a,this.batches=new Map}return n(t,[{key:"storeEntry",value:function(e){var t=function(e){for(var t=JSON.stringify(e),n=t.length,r=t.length-1;r>=0;r--){var o=t.charCodeAt(r);o>127&&o<=2047?n++:o>2047&&o<=65535&&(n+=2),o>=56320&&o<=57343&&r--}return n}(e),n=this.batches.get(e.key)||{browserId:e.browserId,url:e.url,clientMergeId:e.clientMergeId,entries:[],size:0},r=i({},n,{entries:[].concat(a(n.entries),a(e.entries)),size:n.size+t});this.batches.set(e.key,r),r.size>this.maxBatchBytes&&(this.sendBatch(e.key,r),this.batches.delete(e.key))}},{key:"sendBatches",value:function(){var e=this;this.batches.forEach((function(t,n){return e.sendBatch(n,t)})),this.batches=new Map}}]),t}();function H(e,t){J(e,{browserId:t.browserId,url:t.url,clientMergeId:t.clientMergeId,merges:t.entries})}function q(e,t){J(e,{browserId:t.browserId,url:t.url,clientMergeId:t.clientMergeId,features:t.entries})}var F="/cmonster/webapi/opt-out",G="/cmonster/webapi/opt-in";function J(e,t){return o_util.cookie.exists("trackingDisabled")||o_util.toggle.get("tr_disable_bct_requests",!1)?Promise.resolve():!0===window.navigator.sendBeacon(e,JSON.stringify(t))?Promise.resolve():(h()&&console.warn("Unable to send tracking request via beacon api, retrying via XHR now."),new Promise((function(n,r){o_util.ajax.post(e,t).then((function(e){e.status<400?n():r(new Error("Unable to send tracking request: Beacon rejected and Ajax failed with ".concat(e.status," ").concat(e.statusText)))}))})))}function K(e,t){var n=p();if(!n)return Promise.resolve();var r=I(),o="/gate/webapi/v3/pis/".concat(r.currentPageMergeId,"/merges"),a=function(e,t,n){var r=I();return{browserId:e,mergeValues:v(f(n)),onLate:"discard"===t?t:"default",url:r.currentPath,clientMergeId:r.currentScid}}(n,t,i({},e,{},T("merge")));return z()?function(e,t,n){var r={mergeValues:n.mergeValues,onLate:n.onLate};return R.emit(j,{key:e,browserId:t,url:n.url,clientMergeId:n.clientMergeId,entries:[r]})}("/gate/webapi/v1/pis/".concat(r.currentPageMergeId,"/merge-batches"),n,a):J(o,a)}function W(e){var t=p();if(!t)return Promise.resolve();var n=I();return J("/gate/webapi/v2/pis/".concat(n.currentPageMergeId,"/move"),function(e,t,n,r){var o=I(),a={browserId:e,additionalLabels:v(f(n)),source:t,clientMergeId:o.currentScid,targetUrl:o.currentPath};return r?i({},a,{action:r}):a}(t,e.source,e.additionalLabels,e.action))}function U(e,t){var n=p();if(!n)return Promise.resolve();var r=t?"/".concat(t):"",o=t?"eventMerge":"event";return J("/gate/webapi/v1/event".concat(r),function(e,t){var n=I();return{browserId:e,labels:v(f(t)),url:n.currentPath}}(n,i({},e,{},T(o))))}function V(e,t,n){var r=p();if(!r)return Promise.resolve();var o=i({},e),a=n?"/".concat(n):"";try{return J("/gate/webapi/v1/event".concat(a),function(e,t,n){var r=I(),o=v(f(t)),i=E(n);return{browserId:e,url:r.currentPath,labels:o,action:i}}(r,o,t))}catch(e){return Promise.reject(e)}}var Q=10;function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t>=Q?Promise.reject(new Error("Could not send request.")):o_util.ajax.get(e).then((function(n){return 200===n.status||X(e,t+1)}))}function Z(e){var t=p();if(!t)return Promise.resolve();var n=I(),r="/gate/webapi/v2/pis/".concat(n.currentPageMergeId,"/features");try{var o=function(e,t){var n=I(),r=t.map(A);return{browserId:e,clientMergeId:n.currentScid,url:n.currentPath,features:r}}(t,e);return z()?function(e,t,n){return R.emit(N,{key:e,browserId:t,url:n.url,clientMergeId:n.clientMergeId,entries:n.features})}(r,t,o):J(r,o)}catch(e){return Promise.reject(e)}}function Y(){return X(F)}var $={setOptOut:function(e){o_util.toggle.get("tr_save_optout_cookie_without_nitro",!1)?function(e){var t="otto.de:responsive",n="https://cs.oghub.io/optOut";if(o_util.toggle.get("tr_use_new_nitro_optout",!1)){var r=o_util.cookie.get("FP_NITRO"),o=r?"&fpcval=".concat(r):"";e?(n="".concat(n,"?siteId=").concat(t).concat(o),o_util.cookie.set("nitro_optout","serversideTrue",{days:1e4})):(n="".concat(n,"?deactivate=1&siteId=").concat(t).concat(o),o_util.cookie.remove("nitro_optout"))}else{var i=function(){var e=o_util.cookie.get("FP_NITRO");if(e&&e.split(".").length>=4)return e.split(".")[3];return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}();e?(n="".concat(n,"?siteId=").concat(t,"&sessionId=").concat(i),o_util.cookie.set("nitro_optout","true",{days:1e4})):(n="".concat(n,"?deactivate=1&siteId=").concat(t,"&sessionId=").concat(i),o_util.cookie.remove("nitro_optout"))}var a=document.createElement("script");a.src=n,a.async=!0,document.getElementsByTagName("head")[0].appendChild(a)}(e):e?o_util.cookie.set("nitro_optout","true",{days:1e4}):o_util.cookie.remove("nitro_optout")}};var ee=["/shoppages/service/datenschutz","/datenschutz"];var te="ts-move",ne="ts-action",re=te,oe="ts-movedata",ie=new o_global.Storage(window.localStorage);function ae(e){if(2!==e.button){var t,n=g(e.target,re);if(n||"test"===window.__ENV||(t=n.href,/^https?:\/\/[a-zA-Z]*\.?otto\.de/.test(t)))ue(l(n,te),l(n,ne))}}function ce(e){ue(e,null)}function ue(e,t){var n=I(),r=n.currentPageMergeId;if(r){var o={additionalLabels:e||{},source:{clientMergeId:n.currentScid,pageMergeId:r,url:n.currentPath,referrer:document.referrer}};t&&(o.action=E(t)),function(e){ie.setItem(oe,JSON.stringify(e))}(o)}}function se(){var e=function(){try{var e=ie.getItem(oe);return ie.removeItem(oe),JSON.parse(e)}catch(e){return null}}();e&&W(e)}var de="ts-link",le=de,ge="ts-linkdata",fe=new o_global.Storage(window.sessionStorage);function ve(){var e={};try{var t=fe.getItem(ge);return null===t?e:JSON.parse(t.toString())}catch(t){return e}}function he(e){var t=i({},ve(),{},e);fe.setItem(ge,JSON.stringify(t))}function me(e){return o_util.core.isPlainObject(e)&&!s(e)}function be(){var e=ve();return me(e)&&(e.ts_BctFromBrowserStore=!0,fe.removeItem(ge)),e}var we="trackingDisabled";function pe(){return o_util.cookie.exists(we)}var _e=new o_global.Storage(window.localStorage),ke="tabId";function Ie(e){("hidden"in document?document.hidden:"msHidden"in document?document.msHidden:"webkitHidden"in document&&document.webkitHidden)||_e.setItem(ke,e)}var ye=new o_global.Storage(window.sessionStorage);function Me(){return ye.getItem("ts-accesspath-internal")}function Pe(){return window.location.href}function Te(e){var t;t=function(e,t){var n=document.createElement("a");n.href=e;var r=n.host;return e&&r.match(/(?:^|\.)otto\.de$/)?"true":t||"false"}(e,Me()),ye.setItem("ts-accesspath-internal",t)}function xe(){var e;e=Pe(),ye.setItem("ts-unloaded-location-href",e)}function Oe(){return ye.getItem("ts-unloaded-location-href")===Pe()}function Se(){var e=_(10);return{sendEventToTrackingServer:function(t){return U(t,e)},eventMergeId:e}}function Ee(){var e=I();return function(e){if(!e||s(e))return"";var t=Object.keys(e).map((function(t){return[t,encodeURIComponent(e[t])].join("=")}));return"?".concat(t.join("&"))}({psfids:e.currentPageMergeId,scid:e.currentScid,cachefix:_(10),ts_Type:"merge"}).slice(1)}var Ae=window.o_global.eventQBus;function je(e,t){var n=ce(e);t&&Ae.emit(t,n)}function Ne(e,t,n){var r=ue(e,t);n&&Ae.emit(n,r)}function Ce(e,t){var n=U(e);t&&Ae.emit(t,n)}function Re(e,t,n,r){var o=V(t,{name:e,features:n});r&&Ae.emit(r,o)}function Be(e,t,n){var r=V({},e,t);n&&Ae.emit(n,r)}function Le(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=null,o=null;if(t.length>=3&&Array.isArray(t[2])){var i=t[0],a=t[1],c=t[2],u=t[3],s={name:i,features:c};r=function(){return V(a,s)},o=u}else{var d=t[0],l=t[1];r=function(){return V(d,l)},o=t[2]}var g=r();o&&Ae.emit(o,g)}function ze(e){var t=Se();e&&Ae.emit(e,t)}function De(e){var t=Ee();e&&Ae.emit(e,t)}function He(e,t,n){var r=U(e,t);n&&Ae.emit(n,r)}function qe(e,t){var n=K(e,"default");t&&Ae.emit(t,n)}function Fe(e,t,n){var r=K(e,t);n&&Ae.emit(n,r)}function Ge(e,t){var n=Z(e);t&&Ae.emit(t,n)}var Je={submitEvent:"tracking.bct.submitEvent",addActionToEvent:"tracking.bct.addActionToEvent",addToPageImpression:"tracking.bct.addToPageImpression",addToPageImpressionWithStrategy:"tracking.bct.addToPageImpressionWithStrategy",addToEvent:"tracking.bct.addToEvent",getMergeParameters:"tracking.bct.getMergeParameters",createEventMergeContext:"tracking.bct.createEventContext",submitMove:"tracking.bct.submitMove",submitMoveAction:"tracking.bct.submitMoveAction",addFeaturesToPageImpression:"tracking.bct.addFeaturesToPageImpression",submitAction:"tracking.bct.submitAction"};o_global.eventLoader.onReady(1e3,(function(){var e;e=C,R.on(e,(function(){L=!1})),new D(N,C,q),new D(j,C,H);var t=function(){return R.emit(C,"trigger-send-batches")};setTimeout((function(){t()}),1500),o_util.event.add(window,"beforeunload",(function(){t()}))})),o_global.eventLoader.onLoad(1e4,(function(){try{!function(){var e=o_util.cookie.get("ADS_NITRO");if(!e||"[object Object]"!==e)return;var t="localhost"===location.hostname?"":".otto.de";o_util.cookie.remove("ADS_NITRO",{path:"/",domain:t})}()}catch(e){console.error(e)}var e;e=document.location.pathname,ee.some((function(t){return e.substring(0,t.length)===t}))?window.nitro=window.nitro||$:function(){var e=o_util.toggle.get("nitro_js_enabled",!1),t="1"===o_util.cookie.get("cb");if(o_util.toggle.get("tr_save_optout_cookie_without_nitro",!1)){var n=o_util.cookie.get("nitro_optout");return e&&t&&!n}return e&&t}()&&function(e,t,n,r,o,i,a){e[o]=e[o]||{},e[o].cb=a;var c=t.createElement(n),u=t.getElementsByTagName(n)[0];c.async=1,c.src=r,u.parentNode.insertBefore(c,u)}(window,document,"script","https://tp.otto.de/sync/0.2/otto.de:responsive/nitro.min.js","nitro",0,(function(){K({ot_NewNitroCookie:"true"})}))})),o_global.eventLoader.onReady(1e3,(function(){window.TRACKING_moveInitialized||(window.TRACKING_moveInitialized=!0,o_util.event.delegate(document,"click","a.ts-move",ae),se())})),o_global.eventLoader.onReady(1e3,(function(){window.TRACKING_linkdatainitialized||(window.TRACKING_linkdatainitialized=!0,o_util.event.delegate(document,"click","a.ts-link",(function(e){var t=g(e.target,le);if(null!==t&&"_blank"!==t.getAttribute("target")){var n=l(t,de);null!==n&&he(n)}})),o_util.event.delegate(document,"click","a[target=_blank]",(function(e){for(var t=e.target;"A"!==t.tagName&&"_blank"!==t.target;)t=t.parentNode;var n=l(t,de),r=be();(n||me(r))&&U(i({ot_LinkTarget:"extern"},n,{},r))})),K(be(),"default"))})),o_global.eventLoader.onReady(1e3,(function(){window.TRACKING_bctdatainitialized||(window.TRACKING_bctdatainitialized=!0,Te(document.referrer),K(i({},{ts_AccPathInternal:"true"===Me(),ts_ReloadedPage:Oe()},{},x())),o_util.event.add(window,"beforeunload",(function(){xe()})),o_util.event.add(window,"pagehide",(function(){xe()})))})),o_global.eventLoader.onReady(1e3,(function(){if(!window.TRACKING_tabdatainitialized){window.TRACKING_tabdatainitialized=!0;var e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"".concat(e()).concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e())}();K({ts_TabId:e,ts_ParentTabId:_e.getItem(ke)}),window.onfocus=function(){Ie(e)},Ie(e)}})),o_global.eventLoader.onReady(1001,(function(){var e,t=o_util.toggle.get("tr_use_submit_action_fallback",!1),n=o_util.toggle.get("tr_add_addActionToEvent_to_eventqbus",!1),o=(r(e={},Je.submitMove,je),r(e,Je.submitMoveAction,Ne),r(e,Je.addToEvent,He),r(e,Je.addToPageImpression,qe),r(e,Je.addToPageImpressionWithStrategy,Fe),r(e,Je.createEventMergeContext,ze),r(e,Je.submitEvent,Ce),r(e,Je.getMergeParameters,De),r(e,Je.addFeaturesToPageImpression,Ge),r(e,Je.submitAction,t?Le:Re),e);return Object.keys(o).forEach((function(e){return Ae.on(e,o[e])})),n&&Ae.on(Je.addActionToEvent,Be),function(){Object.keys(o).forEach((function(e){return Ae.off(e,o[e])})),n&&Ae.off(Je.addActionToEvent,Be)}})),o_global.eventLoader.onReady(1e3,(function(){pe()&&"true"===o_util.cookie.get(we)&&Y()})),window.o_tracking=window.o_tracking||{},window.o_tracking.bct={closeContext:function(){var e=I();return e.stack.length>1&&U({ts_LayerEvent:"close"}),e.close()},createContext:function(e,t,n){var r=I().create(e,t);return function(e){var t=be();K(o_util.core.extend(t,e),"default"),se()}(n),r},getMergeParameters:Ee,sendEventToTrackingServer:U,sendMergeToTrackingServer:K,createEventMergeContext:Se,sendEventMergeToTrackingServer:U,trackOnNextPageImpression:function(e){return he(e),!0},submitMove:ce},window.o_tracking.optOut={disableTracking:function(){return U({ot_OptOut:"set"}),Y()},enableTracking:function(){return X(G).then((function(){U({ot_OptOut:"reset"})}))},isUserOptOut:pe}}();
//# sourceMappingURL=/tracking-bct/tracking.bct.prebuild.latest.js.map
